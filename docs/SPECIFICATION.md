# TPOT P2P 交易平台 - 完整功能规格

## 1. 用户系统

### 1.1 账户管理
| 功能 | 描述 | 优先级 | 技术方案 |
|------|------|--------|----------|
| 钱包连接 | Phantom/Solflare/Backpack | P0 | @solana/wallet-adapter |
| 个人资料 | 头像、昵称、简介 | P1 | 链上存储/IPFS |
| 收款账户 | 银行卡/支付宝/微信/USDT地址 | P0 | 加密存储 |
| 安全设置 | 交易密码、2FA | P1 | TOTP |

### 1.2 信誉系统
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 交易次数 | 完成交易计数 | P0 |
| 完成率 | 完成数/总数 | P0 |
| 好评率 | 好评数/评价总数 | P0 |
| 信誉等级 | 新手/普通/优秀/卓越 | P1 |
| 徽章系统 | 大额交易/快速付款等徽章 | P2 |

### 1.3 KYC认证（可选）
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 基础认证 | 手机/邮箱验证 | P2 |
| 实名认证 | 身份证/护照 | P3 |
| 商家认证 | 保证金+审核 | P3 |

---

## 2. 订单系统

### 2.1 广告发布
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 交易类型 | 买入/卖出 | P0 |
| 定价方式 | 固定价/市场价+浮动 | P0 |
| 数量设置 | 可用数量 | P0 |
| 限额设置 | 单笔最小/最大金额 | P0 |
| 支付方式 | 多选支付方式 | P0 |
| 支付时限 | 付款超时时间(15-60分钟) | P0 |
| 自动回复 | 首次消息自动回复 | P2 |
| 广告备注 | 对买家的要求说明 | P1 |

### 2.2 广告列表
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 筛选 | 买/卖、币种、支付方式、金额 | P0 |
| 排序 | 价格、完成率、交易量 | P0 |
| 搜索 | 搜索商家/金额 | P1 |
| 分页 | 分页加载 | P0 |

### 2.3 订单状态
```
待付款 → 已付款 → 已放行 → 已完成
   ↓         ↓        ↓
 已取消   申诉中    申诉中
```

| 状态 | 描述 | 超时处理 |
|------|------|----------|
| pending | 等待买家付款 | 15-60分钟自动取消 |
| paid | 买家已付款 | 24小时自动放行 |
| released | 卖家已放行 | - |
| completed | 交易完成 | - |
| cancelled | 已取消 | - |
| disputed | 申诉中 | - |

---

## 3. 交易流程

### 3.1 买入流程
```
1. 选择广告 → 2. 输入金额 → 3. 确认订单
     ↓
4. 锁定卖家TPOT → 5. 获取卖家收款信息
     ↓
6. 线下付款 → 7. 点击"我已付款" → 8. 上传凭证
     ↓
9. 等待卖家确认 → 10. 收到TPOT → 11. 评价
```

### 3.2 卖出流程
```
1. 选择广告 → 2. 输入TPOT数量 → 3. 确认订单
     ↓
4. 锁定卖家TPOT(自己) → 5. 获取买家付款信息
     ↓
6. 等待买家付款 → 7. 收到付款通知 → 8. 核实收款
     ↓
9. 点击"放行TPOT" → 10. 交易完成 → 11. 评价
```

---

## 4. 聊天系统

### 4.1 即时通讯
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 文字消息 | 买卖双方实时聊天 | P0 |
| 图片发送 | 支付凭证截图 | P0 |
| 消息记录 | 历史消息查看 | P0 |
| 未读提醒 | 新消息通知 | P1 |
| 敏感词过滤 | 防止违规内容 | P1 |

### 4.2 快捷消息
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 预设回复 | "已付款，请查收"等 | P1 |
| 常见问题 | FAQ快捷回复 | P2 |

---

## 5. 支付系统

### 5.1 支付方式管理
| 支付方式 | 字段 | 优先级 |
|----------|------|--------|
| 支付宝 | 姓名、账号、二维码 | P0 |
| 微信 | 姓名、微信号、二维码 | P0 |
| 银行卡 | 开户行、户名、账号 | P0 |
| USDT(TRC20) | 钱包地址 | P0 |
| USDT(ERC20) | 钱包地址 | P1 |

### 5.2 支付安全
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 信息加密 | 收款信息加密存储 | P0 |
| 仅订单可见 | 仅交易双方可见 | P0 |
| 交易后隐藏 | 完成后隐藏敏感信息 | P1 |

---

## 6. 争议系统

### 6.1 申诉流程
```
1. 发起申诉 → 2. 选择原因 → 3. 上传证据
     ↓
4. 等待对方响应 → 5. 双方举证
     ↓
6. 客服介入 → 7. 仲裁判决 → 8. 执行结果
```

### 6.2 申诉原因
| 原因 | 描述 |
|------|------|
| 未收到付款 | 卖家声称未收到钱 |
| 已付款未放行 | 买家已付款但卖家不放行 |
| 收款账户错误 | 付款到错误账户 |
| 其他 | 其他争议 |

### 6.3 仲裁机制
| 角色 | 权限 |
|------|------|
| 普通客服 | 处理小额争议 |
| 高级客服 | 处理大额争议 |
| 系统自动 | 超时自动放行 |

---

## 7. 通知系统

### 7.1 站内通知
| 事件 | 通知对象 |
|------|----------|
| 订单创建 | 双方 |
| 买家付款 | 卖家 |
| 卖家放行 | 买家 |
| 订单完成 | 双方 |
| 新消息 | 对方 |
| 申诉状态 | 双方 |

### 7.2 外部通知（可选）
| 方式 | 事件 |
|------|------|
| 邮件 | 重要订单状态 |
| Telegram | 订单提醒 |
| Webhook | API通知 |

---

## 8. 安全系统

### 8.1 账户安全
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 交易密码 | 确认交易时输入 | P1 |
| 2FA认证 | Google Authenticator | P1 |
| 设备管理 | 登录设备记录 | P2 |
| 风控检测 | 异常行为检测 | P2 |

### 8.2 交易安全
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 托管合约 | 资金锁定在智能合约 | P0 |
| 超时机制 | 自动取消/放行 | P0 |
| 黑名单 | 欺诈用户黑名单 | P1 |

---

## 9. 管理后台

### 9.1 用户管理
- 用户列表/搜索
- 用户详情/交易记录
- 封禁/解封
- 信誉调整

### 9.2 订单管理
- 订单列表/搜索
- 订单详情
- 强制取消/完成
- 争议处理

### 9.3 争议管理
- 待处理申诉列表
- 申诉详情/证据
- 仲裁操作

### 9.4 系统设置
- 交易手续费
- 超时时间
- 公告管理
- 黑名单管理

---

## 10. 技术架构

### 10.1 前端
- Next.js 14 (React)
- TailwindCSS
- @solana/wallet-adapter
- Socket.io (聊天)

### 10.2 后端
- Node.js + Express / Fastify
- PostgreSQL (用户/订单)
- Redis (缓存/会话)
- Socket.io (实时通信)

### 10.3 智能合约
- Solana + Anchor
- 订单合约
- 托管合约
- 信誉合约

---

## 11. 优先级排序

### P0 - MVP必需（2周）
1. 钱包连接
2. 发布广告
3. 浏览广告
4. 创建订单
5. 确认付款
6. 释放代币
7. 基础聊天

### P1 - 体验优化（2周）
1. 信誉系统
2. 收款账户管理
3. 图片消息
4. 订单超时
5. 通知系统

### P2 - 完善功能（2周）
1. 争议系统
2. 2FA安全
3. 管理后台
4. 快捷消息

### P3 - 高级功能（按需）
1. KYC认证
2. 商家认证
3. API接口

---

## 确认问题

请确认以下内容：

1. **功能范围**：以上功能是否满足需求？需要增减吗？

2. **优先级**：P0 MVP 功能是否符合你的预期？

3. **技术方案**：是否认可以上技术选型？

4. **开发顺序**：是否按 P0→P1→P2→P3 顺序开发？

5. **其他需求**：有没有特别强调的功能？

---

请回复确认或提出修改意见，我将开始开发。
